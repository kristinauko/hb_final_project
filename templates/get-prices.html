<!DOCTYPE html>
<html>
    <head>
        <title>Price data</title>
          <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>
    <body>
        <h1>{{ name }}</h1>
            <div class='product-div'>
                <h3 id=amazon_id >{{ amazon_id }}</h3>

                <div id='priceDate' style='width:800px;height:400px;''>

                <script>
                    let amazon_id = $('#amazon_id').html();

                    $.get('/get-prices.json', {amazon_id: amazon_id}, (results) => {
                        console.log(results);
                        console.log(results.date);
                        console.log(results.price);
                        console.log(results.prediction_prices)

                        let date_time_list = results.date;
                        let price_list = results.price;
                        let predicted_date_time_list = results.prediction_dates;
                        let predicted_price_list = results.prediction_prices;

                        let plot = { 
                          x: date_time_list,
                          y: price_list,
                          mode: 'lines+markers',
                          type: 'scatter',
                          name: 'Pricing history',
                          line: {shape: 'spline'}
                        };

                        let prediction_plot = { 
                          x: predicted_date_time_list,
                          y: predicted_price_list,
                          mode: 'lines+markers',
                          type: 'scatter',
                          name: 'Pricing prediction',
                          line: {shape: 'spline'}
                        };

                        let layout = {
                        yaxis: {title: "Price in $"},       
                        xaxis: {showgrid: false, 
                        },
                        };

                        let data = [plot, prediction_plot];

                        Plotly.newPlot('priceDate', data, layout);

                        $('#min_price').text('Lowest Price: ' + results.min_price);

                    });

                </script>

                </div>
                <h3 id="min_price"></h3>
            </div>
    </body>
</html>
